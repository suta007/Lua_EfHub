--[[
    AutoHarvest System - Standalone Version
    ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏û‡∏∑‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Grow a Garden
]]

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

--// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
local function GetMyFarm()
    local Farms = workspace.Farm:GetChildren()
    for _, Farm in pairs(Farms) do
        local Owner = Farm.Important.Data.Owner.Value
        if Owner == LocalPlayer.Name then
            return Farm
        end
    end
end

local MyFarm = GetMyFarm()
local PlantsPhysical = MyFarm.Important.Plants_Physical

--// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
local AutoHarvestEnabled = false
local HarvestIgnores = {
    Normal = false,  -- true = ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏∑‡∏ä‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
    Gold = false,    -- true = ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏∑‡∏ä‡∏ó‡∏≠‡∏á
    Rainbow = false  -- true = ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏∑‡∏ä‡∏£‡∏∏‡πâ‡∏á
}

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏û‡∏∑‡∏ä‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
local function CanHarvest(Plant)
    local Prompt = Plant:FindFirstChild("ProximityPrompt", true)
    if not Prompt then return false end
    if not Prompt.Enabled then return false end
    return true
end

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Parent
local function CollectHarvestable(Parent, Plants, IgnoreDistance)
    local Character = LocalPlayer.Character
    if not Character then return Plants end
    
    local PlayerPosition = Character:GetPivot().Position

    for _, Plant in pairs(Parent:GetChildren()) do
        -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Fruits (‡∏ú‡∏•‡πÑ‡∏°‡πâ)
        local Fruits = Plant:FindFirstChild("Fruits")
        if Fruits then
            CollectHarvestable(Fruits, Plants, IgnoreDistance)
        end

        -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á
        local PlantPosition = Plant:GetPivot().Position
        local Distance = (PlayerPosition - PlantPosition).Magnitude
        if not IgnoreDistance and Distance > 15 then continue end

        -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Variant ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á ignore
        local Variant = Plant:FindFirstChild("Variant")
        if Variant and HarvestIgnores[Variant.Value] then continue end

        -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ
        if CanHarvest(Plant) then
            table.insert(Plants, Plant)
        end
    end
    
    return Plants
end

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡∏û‡∏∑‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡πÑ‡∏î‡πâ
local function GetHarvestablePlants(IgnoreDistance)
    local Plants = {}
    CollectHarvestable(PlantsPhysical, Plants, IgnoreDistance)
    return Plants
end

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏û‡∏∑‡∏ä
local function HarvestPlant(Plant)
    local Prompt = Plant:FindFirstChild("ProximityPrompt", true)
    if not Prompt then return end
    
    fireproximityprompt(Prompt)
end

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
local function HarvestAllPlants()
    local Plants = GetHarvestablePlants()
    for _, Plant in pairs(Plants) do
        HarvestPlant(Plant)
    end
end

--// Loop ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á AutoHarvest
local function AutoHarvestLoop()
    while wait(0.01) do
        if not AutoHarvestEnabled then continue end
        HarvestAllPlants()
    end
end

--// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö
coroutine.wrap(AutoHarvestLoop)()

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å)
local AutoHarvest = {}

function AutoHarvest:Enable()
    AutoHarvestEnabled = true
    print("‚úÖ AutoHarvest ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")
end

function AutoHarvest:Disable()
    AutoHarvestEnabled = false
    print("‚ùå AutoHarvest ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")
end

function AutoHarvest:Toggle()
    AutoHarvestEnabled = not AutoHarvestEnabled
    print(AutoHarvestEnabled and "‚úÖ AutoHarvest ‡πÄ‡∏õ‡∏¥‡∏î" or "‚ùå AutoHarvest ‡∏õ‡∏¥‡∏î")
end

function AutoHarvest:SetIgnore(variant, value)
    if HarvestIgnores[variant] ~= nil then
        HarvestIgnores[variant] = value
        print(string.format("üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Ignore %s = %s", variant, tostring(value)))
    end
end

function AutoHarvest:HarvestOnce()
    HarvestAllPlants()
    print("üåæ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß")
end

return AutoHarvest

AutoHarvestEnabled = true

--[[
    ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
    
    AutoHarvest:Enable()              -- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    AutoHarvest:Disable()             -- ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    AutoHarvest:Toggle()              -- ‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î
    AutoHarvest:HarvestOnce()         -- ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    AutoHarvest:SetIgnore("Gold", true)  -- ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏∑‡∏ä‡∏ó‡∏≠‡∏á
]]